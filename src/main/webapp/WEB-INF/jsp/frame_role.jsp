<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%><%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%><%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %><!-- BEGIN PAGE LEVEL STYLES --><link rel="stylesheet" type="text/css" href="media/css/select2_metro.css" /><link rel="stylesheet" href="media/css/DT_bootstrap.css" /><link rel="stylesheet" href="media/zTree/css/zTreeStyle.css" type="text/css"><!-- END PAGE LEVEL STYLES --><!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM--><div id="portlet-config" class="modal hide">	<div class="modal-header">		<button data-dismiss="modal" class="close" type="button"></button>		<h3>portlet Settings</h3>	</div>	<div class="modal-body">		<p>Here will be a configuration form</p>	</div></div><!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM--><div class="row-fluid">	<!-- BEGIN PAGE HEADER-->	<div class="span12">		<!-- BEGIN PAGE TITLE & BREADCRUMB-->		<h3 class="page-title">			${pd.ROLE_TITLE} <small>${pd.ROLE_SUBTITLE}</small>		</h3>		<ul class="breadcrumb">			<li>				<i class="icon-home"></i>				<a href="index.html">${pd.HOME}</a>				<i class="icon-angle-right"></i>			</li>			<li>				<a href="#">${pd.ROLE_SUBTITLE}</a>				<i class="icon-angle-right"></i>			</li>			<li><a href="#">${pd.ROLE_SUBTITLE}</a></li>		</ul>		<!-- END PAGE TITLE & BREADCRUMB-->	</div>	<!-- END PAGE HEADER-->	<!-- BEGIN PAGE CONTENT-->	<div class="row-fluid">	<div class="span12">		<!-- BEGIN EXAMPLE TABLE PORTLET-->		<div class="portlet box yellow" id="cont">			<div class="portlet-title">				<div class="caption">					<i class="icon-coffee"></i>${pd.ROLE_SUBTITLE}				</div>				<div class="tools">					<a href="javascript:;" class="collapse"></a>					<a href="#portlet-config" data-toggle="modal" class="config"></a>					<a href="javascript:void(0);" class="reload" id="refresh"></a>					<a href="javascript:;" class="remove"></a>				</div>			</div>			<div class="portlet-body">				<div class="clearfix">					<!-- Add New Start -->					<div class="btn-group">						<a href="javascript:void(0);" class="btn yellow"  onclick="addNewRoleBtn()" data-toggle="modal">${pd.ROLE_ADD}<i class="icon-plus"></i></a>					</div>					<!-- Add New End -->					<div class="btn-group pull-right">						<button class="btn dropdown-toggle" data-toggle="dropdown">${pd.TOOLS}<i class="icon-angle-down"></i>						</button>						<ul class="dropdown-menu pull-right">							<li><a href="#">${pd.PRINT}</a></li>							<li><a href="#">${pd.PDF}</a></li>							<li><a href="#">${pd.EXCEL}</a></li>						</ul>					</div>				</div>				<div id="baseTable">					<table class="table table-bordered table-hover">						<thead>							<tr>								<th>${pd.INDEX}</th>								<th>${pd.ROLE_NAME}</th>								<th>${pd.DELETE}</th>								<th>${pd.ROLE_UPDATE}</th>								<th hidden></th>								<th hidden></th>							</tr>						</thead>						<tbody>							<c:choose>								<c:when test="${not empty rolesList}">									<c:forEach items="${rolesList}" var="rolesList" varStatus="role">										<tr>											<td>${role.index+1}</td>											<td>${rolesList.ROLE_NAME}</td>											<td hidden>${rolesList.RIGHTS}</td>											<td hidden>${rolesList.ROLE_ID}</td>											<td>												<a href = "javascript:void(0);" class="btn red icn-only" onclick="deleteBtn(this)"><i class="icon-remove icon-white"></i></a>											</td>											<td>												<a href="javascript:void(0);" class="btn green icn-only" onclick="assignBtn(this)"><i class="icon-user icon-white"></i></a>											</td>										</tr>									</c:forEach>								</c:when>							</c:choose>						</tbody>					</table>				</div>				<div id="addNewRole" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3" aria-hidden="true">					<div class="modal-header">						<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>						<h3 id="myModalLabel3">Confirm Header</h3>					</div>					<div class="modal-body">						<div class="portlet-body form">							<form action="#" class="form-horizontal form-bordered">								<div class="control-group">									<label class="control-label">First Name</label>									<div class="controls">										<input type="text" placeholder="small" class="m-wrap span12" />										<span class="help-inline">This is inline help</span>									</div>								</div>								<div class="control-group">									<label class="control-label">Last Name</label>									<div class="controls">										<input type="text" placeholder="medium" class="m-wrap span12" />										<span class="help-inline">This is inline help</span>									</div>								</div>								<div class="control-group">									<label class="control-label">Gender</label>									<div class="controls">										<select  class="m-wrap span12">											<option value="">Male</option>											<option value="">Female</option>										</select>									</div>								</div>							</form>						</div>					</div>					<div class="modal-footer">						<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>						<button data-dismiss="modal" class="btn blue" id="confirmBtn">Confirm</button>					</div>				</div>				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">					<div class="modal-dialog">						<div class="modal-content">							<div class="modal-header">								<h4 class="modal-title" id="myModalLabel">${pd.DELETE_TITLE}</h4>							</div>							<div class="modal-body">								${pd.DELETE_CONFIRM} <span id="rolename"></span>							</div>							<div class="modal-footer">								<button type="button" class="btn btn-default" data-dismiss="modal">${pd.CLOSE}</button>								<button type="button" class="btn btn-primary" data-dismiss="modal" id="delBtn">${pd.CONFIRM}</button>							</div>						</div>					</div>				</div>				<div id="roleAssignment" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">					<div class="modal-header">						<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>						<h3 id="roleAssignmentLabel">${pd.ROLE_ASSIGNMENT}</h3>					</div>					<div class="modal-body">						<form  class="form-horizontal" id="assignment">							<div class="zTreeDemoBackground">								<ul id="treeDemo" class="ztree"></ul>								<span hidden id="rightRole"></span>							</div>							<div class="form-actions">								<button class="btn" id="assignRoleBtn" data-dismiss="modal" aria-hidden="true">${pd.CONFIRM}</button>							</div>						</form>					</div>				</div>			</div>		</div>		<!-- END EXAMPLE TABLE PORTLET-->	</div></div>	<!-- END PAGE CONTENT --></div><!-- BEGIN PAGE LEVEL PLUGINS --><script type="text/javascript" src="media/js/select2.min.js"></script><script type="text/javascript" src="media/js/jquery.dataTables.js"></script><script type="text/javascript" src="media/js/DT_bootstrap.js"></script><!-- END PAGE LEVEL PLUGINS --><!-- BEGIN PAGE LEVEL SCRIPTS --><script src="media/js/app.js"></script><script src="media/js/table-editable.js"></script><script type="text/javascript" src="media/zTree/js/jquery.ztree.core.js"></script><script type="text/javascript" src="media/zTree/js/jquery.ztree.excheck.js"></script><script type="text/javascript" src="media/zTree/js/zTree-check.js"></script><!-- END PAGE LEVEL SCRIPTS --><script type="text/javascript">	jQuery(document).ready(function() {		TableEditable.init();		ZTreeCheck.init();	});</script><script type="text/javascript">	function addNewRoleBtn(){		$("#addNewRole").modal('show');	}</script><script type="text/javascript">	$(function(){		$("#confirmBtn").click(function () {			$.ajax({				type : 'post',				url : 'addRole',				async : true,				data : {"time" : new Date()},				success : function (data) {					$("#baseTable").html(data);				}			});		});	})</script><script type="text/javascript">	function deleteBtn(obj){		var ob = $(obj).parent().parent().find('td');		$("#rolename").html(ob.eq(1).text());		$("#myModal").modal('show');	}</script><script type="text/javascript">	$(function () {		$("#delBtn").click(function () {			var rolename = $("#rolename").html();			$.ajax({				type : 'post',				url : 'deleteRole',				async : true,				data : {"roleName" : rolename},				success : function(data){					$("#baseTable").html(data);				}			});		});	})</script><script type="text/javascript">	function assignBtn(obj) {		var tree = $.fn.zTree.getZTreeObj("treeDemo");		var ob = $(obj).parent().parent().find('td');		var rights = ob.eq(2).text();		$("#rightRole").html(ob.eq(3).text());		$.ajax({			type : 'post',			url : 'getMenu',			data : {"rights" : rights},			success : function (data) {				var nodes = data.nodes;				for(var i=0;i<nodes.length;i++){					var local = nodes[i].id;					var childNode = tree.getNodeByParam("id", local, null);					if(!childNode.isParent){						var checkflag = nodes[i].checked;						if(checkflag=='true'){							childNode.checked = true;							tree.checkNode(childNode,true,true,true);						}else{							childNode.checked = false;							tree.checkNode(childNode,false,true,true);						}					}				}			}		});		$("#roleAssignment").modal('show');	}</script><script type="text/javascript">	$(function(){		$("#assignRoleBtn").click(function () {			//获取zTree 选中的node			var rightRole = $("#rightRole").html();			var t = $.fn.zTree.getZTreeObj("treeDemo");			var checkCount = t.getCheckedNodes(true);			var result = [];			for(var i=0;i<checkCount.length;i++) {				result[i] = checkCount[i].id;			}			$.ajax({				type : 'post',				url : 'saveRights?checkCount='+result+'&rightRole='+rightRole,				async : false,				success : function (data) {					$("#baseTable").html(data);				}			});		});	})</script><script type="text/javascript">	$(function () {		$("#refresh").click(function () {			$.ajax({				type : 'post',				url  : 'refresh',				data : {"refreshType" : "role"},				success : function (data) {					$("#baseTable").html(data);				}			});		});	})</script>